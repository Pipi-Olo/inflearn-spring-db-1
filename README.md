# JDBC
## ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
![](https://velog.velcdn.com/images/pipiolo/post/0baa42f9-d6fe-40c8-8b0d-aa363448d6f6/image.png)

* ì„œë²„ì™€ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ìœ¼ë¡œ ì—°ê²°í•œë‹¤.
  * `TCP/IP` ë¥¼ ì‚¬ìš©í•´ì„œ ì»¤ë„¥ì…˜ì„ ì—°ê²°í•œë‹¤.
  * ì»¤ë„¥ì…˜ì„ í†µí•´ SQL ì„ DB ì— ì „ë‹¬í•œë‹¤.
  * DB ëŠ” ì „ë‹¬ëœ SQL ì„ ìˆ˜í–‰í•˜ê³  ì‘ë‹µ ê²°ê³¼ë¥¼ ì„œë²„ì— ë³´ë‚´ì¤€ë‹¤.
* ê° ë°ì´í„°ë² ì´ìŠ¤ ë§ˆë‹¤ ì»¤ë„¥ì…˜ì„ ì—°ê²°í•˜ëŠ” ë°©ë²•, SQL ì „ë‹¬í•˜ëŠ” ë°©ë²• ë“± ë°©ë²•ì´ ëª¨ë‘ ë‹¤ë¥´ë‹¤.
  * ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ì€ ë§ì€ ë¹„ìš©ì„ ìš”êµ¬í•œë‹¤.
  
## JDBC ì´í•´
![](https://velog.velcdn.com/images/pipiolo/post/c2f1b7e4-b572-4dc7-a50f-ebb6c887b2cf/image.png)

* ê° ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ ì‚¬ìš©ë²•ì´ ë‹¤ë¥´ë‹¤. 
* ìë°”ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†í•  ìˆ˜ ìˆëŠ” `JDBC(Java Database Connectivity)` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
  * ê° ë°ì´í„°ë² ì´ìŠ¤ íšŒì‚¬ë“¤ì´ JDBC ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ë¥¼ ì œê³µí•˜ëŠ”ë°, ì´ë¥¼ JDBC ë“œë¼ì´ë²„ë¼ í•œë‹¤.
* JDBC ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ë©´, ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³€ê²½í•´ë„ DB ì ‘ì†í•˜ëŠ” ì½”ë“œëŠ” ë³€ê²½í•  í•„ìš” ì—†ë‹¤.

### JDBC ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
![](https://velog.velcdn.com/images/pipiolo/post/256cb057-b498-474d-91e3-c2f5b0d2406e/image.png)

* JDBC ê°€ ì œê³µí•˜ëŠ” `DriverManager.getConnection(URL, USERNAME, PASSWORD)`ì„ ì‚¬ìš©í•œë‹¤.
* `DriverManager` ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë“±ë¡ëœ DB ë“œë¼ì´ë²„ë¥¼ ì¸ì‹í•œë‹¤.
  * `URL` : `jdbc:h2:tcp://localhost/~/test`
  * ê°ê°ì˜ DB ë“œë¼ì´ë²„ëŠ” URL ì •ë³´ë¥¼ í†µí•´ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ìš”ì²­ì¸ì§€ í™•ì¸í•œë‹¤.
    * `jdbc:h2` â†’ H2 ë°ì´í„°ë² ì´ìŠ¤
  * `USERNAME`, `PASSWORD` ë“± ì ‘ì†ì— í•„ìš”í•œ ì¶”ê°€ ì •ë³´ë¥¼ ì…ë ¥í•œë‹¤.
* ì»¤ë„¥ì…˜ êµ¬í˜„ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

> **í‘œì¤€í™”ì˜ í•œê³„**
JDBC ì˜ ë“±ì¥ìœ¼ë¡œ ë§ì€ ê²ƒë“¤ì´ í¸ë¦¬í•´ì¡Œì§€ë§Œ ê°ê°ì˜ ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ SQL, ë°ì´í„° íƒ€ì… ë“± ì¼ë¶€ ì‚¬ìš©ë²•ì´ ë‹¤ë¥´ë‹¤. JDBC ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ì„ ì–»ëŠ” ë°©ë²•ì€ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ë˜ì§€ë§Œ, SQL ì€ í•´ë‹¹ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ê²Œ ë³€ê²½í•´ì•¼ í•œë‹¤. ì´ëŠ” **JPA**(`Java Persistence API`)ë¥¼ í†µí•´ ë§ì€ ë¶€ë¶„ì„ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

## ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ 
* SQL Mapper
  * JDBC ë¥¼ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•˜ë„ë¡ ë„ì™€ì¤€ë‹¤.
  * ê°œë°œìê°€ SQL ì„ ì§ì ‘ ì‘ì„±í•´ì•¼ í•œë‹¤.
  * ëŒ€í‘œ ê¸°ìˆ  : `JdbcTemplate`, `MyBatis`
* ORM
  * ê°ì²´ë¥¼ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘í•´ì£¼ëŠ” ê¸°ìˆ ì´ë‹¤.
  * ê°œë°œìëŠ” ì§ì ‘ SQL ì„ ì‘ì„±í•˜ì§€ ì•Šê³ , ORM ê¸°ìˆ ì´ ë™ì ìœ¼ë¡œ SQL ì„ ë§Œë“¤ì–´ì¤€ë‹¤.
  * ê°ê°ì˜ ë°ì´í„°ë² ì´ìŠ¤ë§ˆë‹¤ ë‹¤ë¥¸ SQL ë¬¸ì œë„ í•´ê²°í•´ì¤€ë‹¤.
  * ëŒ€í‘œ ê¸°ìˆ  : `JPA`, `Hibernate`
    * JPAëŠ” ìë°” ì§„ì˜ì˜ ORM í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ê³  í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” êµ¬í˜„ì²´ì´ë‹¤.
* ê³µí†µì 
  * ë‚´ë¶€ì—ëŠ” ëª¨ë‘ JDBC ë¥¼ ì‚¬ìš©í•œë‹¤.

---

# ì»¤ë„·ì…˜ í’€ê³¼ ë°ì´í„° ì†ŒìŠ¤
## ì»¤ë„¥ì…˜ í’€ ì´í•´
### ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ íšë“
![](https://velog.velcdn.com/images/pipiolo/post/cfb173ab-7b9d-46c4-a9fa-1e0a79f12cce/image.png)

* ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•  ë•Œë§ˆë‹¤ ì»¤ë„¥ì…˜ì„ ìƒˆë¡œ ìƒì„±í•˜ëŠ” ê²ƒì€ ê³¼ì •ë„ ë³µì¡í•˜ê³  ì‹œê°„ì´ ë§ì´ ì†Œëª¨ëœë‹¤.

### ì»¤ë„¥ì…˜ í’€
![](https://velog.velcdn.com/images/pipiolo/post/8cd99f63-6c51-40df-90c2-cca6b418d790/image.png)

* ì»¤ë„¥ì…˜ì„ ë¯¸ë¦¬ ìƒì„±í•´ë‘ê³  ì‚¬ìš©í•˜ëŠ” **ì»¤ë„¥ì…˜ í’€**ì„ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
  * ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹œì‘í•˜ëŠ” ì‹œì ì— í•„ìš”í•œ ë§Œí¼ ë¯¸ë¦¬ ì»¤ë„¥ì…˜ì„ ìƒì„±í•´ì„œ í’€ì— ë³´ê´€í•œë‹¤. 
  * ê¸°ë³¸ ê°’ì€ 10ê°œì´ë‹¤.
* ì»¤ë„¥ì…˜ì€ `TCP / IP` ë¡œ DB ì™€ ì—°ê²°ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì¦‰ì‹œ SQL ì„ DB ì— ì „ë‹¬í•  ìˆ˜ ìˆë‹¤.
* ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì»¤ë„¥ì…˜ í’€ì„ í†µí•´ ì´ë¯¸ ìƒì„±ëœ ì»¤ë„¥ì…˜ì„ ê°ì²´ ì°¸ì¡°ë¡œ ê°€ì ¸ë‹¤ ì“´ë‹¤. 
  * ì»¤ë„¥ì…˜ì„ ëª¨ë‘ ì‚¬ìš©í•˜ê³  ë‚˜ë©´, ì»¤ë„¥ì…˜ì„ ì¢…ë£Œí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì»¤ë„¥ì…˜ì„ ê·¸ëŒ€ë¡œ í’€ì— ë°˜í™˜í•œë‹¤.
* ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜ê°€ ì œí•œë˜ì–´ ìˆì–´, DB ì—°ê²°ì´ ë¬´í•œì • ëŠ˜ì–´ë‚˜ëŠ” ê²ƒì„ ë§‰ì•„ì£¼ëŠ” DB ë³´í˜¸ ê¸°ëŠ¥ íš¨ê³¼ë„ ìˆë‹¤.
* ìŠ¤í”„ë§ ë¶€íŠ¸ 2.0 ë¶€í„°ëŠ” `HikariCP` ê°€ ê¸°ë³¸ ì»¤ë„¥ì…˜ í’€ë¡œ ì‘ë™í•œë‹¤.

## ë°ì´í„° ì†ŒìŠ¤
![](https://velog.velcdn.com/images/pipiolo/post/f4f1256a-a68d-4665-a107-6a289c6aa29f/image.png)

* ì»¤ë„¥ì…˜ íšë“ ë°©ë²•ì„ ì¶”ìƒí™”í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ **`DataSource`** ë¼ í•œë‹¤.
  * `DataSource` ì˜ í•µì‹¬ ê¸°ëŠ¥ì€ ì»¤ë„¥ì…˜ ì¡°íšŒì´ë‹¤.
* ì»¤ë„¥ì…˜ íšë“ì€ `DataSource` ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•˜ë©´ ëœë‹¤.

> **ì°¸ê³ **
> `DriverManager` ëŠ” `DataSource` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. ìŠ¤í”„ë§ì€ `DriverManagerDataSource` ë¼ëŠ” `DataSource` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¥¼ ì œê³µí•œë‹¤.

---

# íŠ¸ëœì­ì…˜ ì´í•´
* íŠ¸ëœì­ì…˜ì€ í•˜ë‚˜ì˜ ê±°ë˜ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë„ë¡ ë³´ì¥í•´ì¤€ë‹¤.
* ëª¨ë“  ì‘ì—…ì„ ì„±ê³µí•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì •ìƒ ë°˜ì˜í•˜ëŠ” ê²ƒì„ `commit` ì´ë¼ í•œë‹¤.
* ì‘ì—… ì¤‘ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•´ì„œ ë˜ëŒë¦¬ëŠ” ê²ƒì„ `rollback` ì´ë¼ í•œë‹¤.

## íŠ¸ëœì­ì…˜ ACID

* ì›ìì„±(`Atomicity`) 
  ğŸ‘‰ íŠ¸ë™ì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰í•œ ì‘ì—…ë“¤ì€ ë§ˆì¹˜ í•˜ë‚˜ì¸ ê²ƒì²˜ëŸ¼ ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼ í•œë‹¤.
* ì¼ê´€ì„±(`Consistency`)
  ğŸ‘‰ ëª¨ë“  íŠ¸ëœì­ì…˜ì€ ì¼ê´€ì„± ìˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼ í•œë‹¤.
* ê²©ë¦¬ì„±(`Isolation`)
  ğŸ‘‰ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” íŠ¸ëœì­ì…˜ë“¤ì´ ì„œë¡œì—ê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šì•„ì•¼ í•œë‹¤. 
  * ê²©ë¦¬ì„±ì€ ë™ì‹œì„±ê³¼ ê´€ë ¨ëœ ì„±ëŠ¥ ì´ìŠˆë¡œ ì¸í•´ ê²©ë¦¬ ìˆ˜ì¤€ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.
    * ì»¤ë°‹ë˜ì§€ ì•Šì€ ì½ê¸°(READ UNCOMMITED)
    * ì»¤ë°‹ëœ ì½ê¸°(READ COMMITTED) : ê°€ì¥ ë§ì´ ì‚¬ìš©í•œë‹¤.
    * ë°˜ë³µ ê°€ëŠ¥í•œ ì½ê¸°(REPEATABLE READ)
    * ì§ë ¬í™”(SERIALIZABLE)
* ì§€ì†ì„±(`Durability`)
  ğŸ‘‰ íŠ¸ëœì­ì…˜ì„ ì„±ê³µì ìœ¼ë¡œ ëë‚´ë©´ ê·¸ ê²°ê³¼ê°€ í•­ìƒ ê¸°ë¡ë˜ì–´ì•¼ í•œë‹¤. 
  * ë¬¸ì œê°€ ë°œìƒí•´ë„ ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸ë¥¼ í†µí•´ ì„±ê³µí•œ íŠ¸ë™ì­ì…˜ì„ ë³µêµ¬í•´ì•¼ í•œë‹¤.

## ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°ì™€ ì„¸ì…˜ ì´í•´
![](https://velog.velcdn.com/images/pipiolo/post/e19370a6-4ad7-492e-a101-561265966605/image.png)

* ì„œë²„ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°ì„ ìš”ì²­í•˜ê³  ì»¤ë„¥ì…˜ì„ ì–»ëŠ”ë‹¤.
* ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë‚´ë¶€ì— ì„¸ì…˜ì„ ë§Œë“ ë‹¤.
  * ì»¤ë„¥ì…˜ì„ í†µí•œ ëª¨ë“  ìš”ì²­ì€ ì„¸ì…˜ì„ í†µí•´ì„œ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.
  * ì„¸ì…˜ì´ SQL ë° íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤.
* ì»¤ë„¥ì…˜ : ì„¸ì…˜ = 1 : 1 í•­ìƒ ë§Œì¡±í•œë‹¤.
  * ì»¤ë„¥ì…˜ í’€ì´ 10ê°œì˜ ì»¤ë„¥ì…˜ì„ ìƒì„±í•˜ë©´, ë°ì´í„°ë² ì´ìŠ¤ëŠ” 10ê°œì˜ ì„¸ì…˜ì„ ë§Œë“ ë‹¤.

### Commit vs Rollback

* ë°ì´í„°ë¥¼ ë³€ê²½í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ë°˜ì˜í•˜ë ¤ë©´ `commit` ì„ í˜¸ì¶œí•œë‹¤.
* ê²°ê³¼ë¥¼ ë°˜ì˜í•˜ê³  ì‹¶ì§€ ì•Šìœ¼ë©´ `rollback` ì„ í˜¸ì¶œí•œë‹¤.
* `commit` ì„ í˜¸ì¶œí•˜ê¸° ì „ê¹Œì§€ëŠ” ë°ì´í„°ë¥¼ ì„ì‹œë¡œ ì €ì¥í•˜ëŠ” ê²ƒì´ë‹¤.
  * `commit` ì„ í•˜ì§€ ì•Šì•„ë„, í•´ë‹¹ ì„¸ì…˜ì€ ë³€ê²½ëœ ë°ì´í„°ê°€ ë³´ì¸ë‹¤.
  * `commit` ì„ í•˜ê¸° ì „ê¹Œì§€, ë‹¤ë¥¸ ì„¸ì…˜ì€ ë³€ê²½ëœ ë°ì´í„°ê°€ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.

### ìë™ì»¤ë°‹ vs ìˆ˜ë™ì»¤ë°‹

* ìë™ ì»¤ë°‹
  * íŠ¸ëœì­ì…˜ ê¸°ë³¸ ë™ì‘ì´ë‹¤.
  * ê°ê°ì˜ ì¿¼ë¦¬ ì‹¤í–‰ ì§í›„ì— ìë™ìœ¼ë¡œ ì»¤ë°‹ì„ í˜¸ì¶œí•œë‹¤.
  * íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ì„ ì œëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
    * íŠ¸ëœì­ì…˜ì€ ì •ìƒ ë™ì‘í•˜ë‚˜ 1ê°œì˜ ì¿¼ë¦¬ ë‹¨ìœ„ë¡œ ì ìš©ë˜ê¸° ë•Œë¬¸ì—, ê¸°ëŠ¥ì´ ì œí•œì ì´ë‹¤.
* ìˆ˜ë™ ì»¤ë°‹
  * `set autocommit false`
  * ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ **íŠ¸ëœì­ì…˜ì´ ì‹œì‘**í•œë‹¤ê³  í‘œí˜„í•œë‹¤.
  * ìˆ˜ë™ ì»¤ë°‹ ì„¤ì •ì„ í•˜ë©´ ê¼­ `commit` í˜¹ì€ `rollback` ì„ í•´ì¤˜ì•¼ í•œë‹¤.
* ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë‚˜ ìë™ ì»¤ë°‹ ëª¨ë“œëŠ” í•œ ë²ˆ ì„¤ì •í•˜ë©´ ë³€ê²½í•˜ê¸° ì „ê¹Œì§€ í•´ë‹¹ ì„¸ì…˜ì—ì„œëŠ” ê³„ì† ìœ ì§€ëœë‹¤.
  * ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•œë‹¤ë©´, ë°˜ë‚© í•˜ê¸° ì „ ë‹¤ì‹œ ìë™ ì»¤ë°‹ëª¨ë“œë¡œ ë˜ëŒë¦¬ì.

## ë°ì´í„°ë² ì´ìŠ¤ ë½(Lock)

* ì—¬ëŸ¬ ì„¸ì…˜ì—ì„œ ë™ì‹œì— ê°™ì€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê²Œ ë˜ë©´ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. 
  * íŠ¸ëœì­ì…˜ì˜ ì›ìì„±ì´ ê¹¨ì§„ë‹¤.
* í•œ ì„¸ì…˜ì´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë™ì•ˆì—ëŠ” ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ í•´ë‹¹ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ìˆ˜ ì—†ê²Œ ë§‰ì•„ì•¼ í•œë‹¤.

### ë³€ê²½ê³¼ ë½(Lock)
![](https://velog.velcdn.com/images/pipiolo/post/ac070f07-accc-433b-9348-9ad4975128b4/image.png)

* ì„¸ì…˜ 1ì´ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ë©´, í•´ë‹¹ ë¡œìš°(ë°ì´í„°)ì˜ ë½ì„ ë¨¼ì € íšë“í•´ì•¼ í•œë‹¤.
* ì„¸ì…˜ 2ë„ ê°™ì€ ë°ì´í„°ë¥¼ ë³€ê²½í•˜ë ¤ê³  ì‹œë„í•œë‹¤. 
  * ë½ì´ ì—†ìœ¼ë¯€ë¡œ ë½ì´ ëŒì•„ì˜¬ ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.
  * ë¬´í•œì • ëŒ€ê¸°í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ì¼ì • ì‹œê°„ì„ ë„˜ì–´ê°€ë©´ ë½ íƒ€ì„ì•„ì›ƒ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
* ì„¸ì…˜ 1ì´ ì»¤ë°‹ì„ ìˆ˜í–‰í•œë‹¤. íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë˜ì—ˆìœ¼ë¯€ë¡œ ë½ì„ ë°˜ë‚©í•œë‹¤.
* ì„¸ì…˜ 2ëŠ” ë½ì„ íšë“í•œë‹¤. ë°ì´í„°ë¥¼ ë³€ê²½í•œë‹¤.
* ì„¸ì…˜ 2ëŠ” ì»¤ë°‹ì„ í•˜ê³  íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•œë‹¤. ë½ì„ ë°˜ë‚©í•œë‹¤.

### ì¡°íšŒì™€ ë½(Lock)

* ì¼ë°˜ì ìœ¼ë¡œ ì¡°íšŒëŠ” ë½ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
  * ë‹¤ë¥¸ ì„¸ì…˜ì´ ë½ì„ íšë“ í•˜ê³  ë°ì´í„°ë¥¼ ë³€ê²½í•˜ê³  ìˆì–´ë„, ë°ì´í„° ì¡°íšŒëŠ” í•  ìˆ˜ ìˆë‹¤.
    * ì¡°íšŒí•œ ë°ì´í„°ëŠ” ì•„ì§ ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œ ì»¤ë°‹ì„ í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ì„¸ì…˜ì´ ë³€ê²½í•˜ê¸° ì´ì „ì˜ ë°ì´í„°ì´ë‹¤.
* ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œë„ ë½ì„ íšë“í•˜ê³  ì‹¶ì„ ë•Œ, `select for update` êµ¬ë¬¸ì„ ì‚¬ìš©í•œë‹¤.
  * ë‹¤ë¥¸ ì„¸ì…˜ì—ì„œëŠ” ë°ì´í„°ë¥¼ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤.
  * ì»¤ë°‹í•˜ê±°ë‚˜ ë¡¤ë°±í•˜ë©´ ë½ì„ ë°˜ë‚©í•œë‹¤.
  * ê³„ì¢Œ ì´ì²´ ê°™ì€ í•´ë‹¹ ë°ì´í„°ë¥¼ ë‹¤ë¥¸ ê³³ì—ì„œ ë³€ê²½í•˜ì§€ ëª»í•˜ë„ë¡ ê°•ì œë¡œ ë§‰ì•„ì•¼ í•  ë–„ ì‚¬ìš©í•œë‹¤.

## ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ê³¼ íŠ¸ëœì­ì…˜
![](https://velog.velcdn.com/images/pipiolo/post/54f6e0dd-e9c9-43ef-808b-5a3f4e795ce5/image.png)

* íŠ¸ëœì­ì…˜ì€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ ìˆëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì‹œì‘í•´ì•¼ í•œë‹¤.
* ì„œë¹„ìŠ¤ ê³„ì¸µì˜ ì»¤ë„¥ì…˜ê³¼ ë¦¬í¬ì§€í† ë¦¬ì˜ ì»¤ë„¥ì…˜ì„ ê°™ê²Œ ìœ ì§€í•´ì•¼ í•œë‹¤.
  * íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ë™ì•ˆ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•´ì•¼ í•œë‹¤.

---

# íŠ¸ëœì­ì…˜
## ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§
![](https://velog.velcdn.com/images/pipiolo/post/f2d9939a-ad24-42df-8f87-d92b5a777742/image.png)

* í”„ë¦¬ì  í…Œì´ì…˜ ê²Œì¸µ `@Controller`
  * UI ê´€ë ¨ ì²˜ë¦¬
  * ì›¹ ìš”ì²­âˆ™ì‘ë‹µ
  * ê¸°ìˆ  : ì„œë¸”ë¦¿ ë“± HTTP ì›¹ ê¸°ìˆ , Spring MVC
* ì„œë¹„ìŠ¤ ê³„ì¸µ `@Service`
  * ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§
  * ê¸°ìˆ  : íŠ¹ì • ê¸°ìˆ ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ” ìˆœìˆ˜ ìë°” ì½”ë“œ
* ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ `@Repository`
  * ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼
  * ê¸°ìˆ  : JDBC, JPA, Redis

## ì„œë¹„ìŠ¤ ê³„ì¸µì€ ìˆœìˆ˜í•´ì•¼í•œë‹¤.
```java
@Service
public class Service {
    private Repository repositry;
    private DataSource dataSource;

    public void save(Entity e) throws SQLException {
        Connection con = dataSource.getConnection();
        try {
            con.setAutoCommit(false); // transaction start
            repository.save(e, con);  // bizLogic
            con.commit();             // commit
        } catch (Exception e) {
            com.rollback();           // rollback
            throw new IllegalStateException(e);
        } finally {
            con.setAutoCommit(true);  // Connection Pool
            con.close();
        }
    }
}
```

* í•´ë‹¹ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ì„ ê°€ì§€ê³  ìˆë‹¤.
* **ì„œë¹„ìŠ¤ ê³„ì¸µì€ ìˆœìˆ˜í•´ì•¼ í•œë‹¤.**
  * íŠ¹ì • ê¸°ìˆ ì— ì˜ì¡´í•˜ì§€ ì•Šê³ , ìˆœìˆ˜ ìë°” ì½”ë“œë¡œë§Œ ì‘ì„±í•´ì•¼ í•œë‹¤.
  * í”„ë¦¬ì  í…Œì´ì…˜ ê³„ì¸µì€ UIì™€ ê´€ë ¨ëœ ê¸°ìˆ ë“¤ë¡œë¶€í„° ì„œë¹„ìŠ¤ ê³„ì¸µì„ ë³´í˜¸í•œë‹¤.
  * ë°ì´í„° ì ‘ê·¼ ê³„ì¸µì€ ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ ë¡œë¶€í„° ì„œë¹„ìŠ¤ ê³„ì¸µì„ ë³´í˜¸í•œë‹¤.
    * `SQLException` JDBC ì˜ˆì™¸ ê°™ì€ **íŠ¹ì • ê¸°ìˆ ì— ì˜ì¡´í•˜ê³  ìˆë‹¤.**
* íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë¬¸ì œ
  * íŠ¸ëœì­ì…˜ì€ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì‹œì‘í•˜ëŠ”ë°, ë°ì´í„° ë² ì´ìŠ¤ ì ‘ê·¼ì€ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì´ë£¨ì–´ì§„ë‹¤.
  * **ì„œë¹„ìŠ¤ ê³„ì¸µì˜ ì»¤ë„¥ì…˜ê³¼ ë¦¬í¬ì§€í† ë¦¬ì˜ ì»¤ë„¥ì…˜ì„ ë™ê¸°í™” ì‹œì¼œì•¼ í•œë‹¤.**
    * íŒŒë¼ë¯¸í„°ë¡œ ì»¤ë„¥ì…˜ì„ ë„˜ê²¨ì£¼ê³  ìˆë‹¤.
* íŠ¸ëœì­ì…˜ ì ìš© ë°˜ë³µ ë¬¸ì œ
  * íŠ¸ëœì­ì…˜ì„ ì ìš©í•  ë•Œ ë§ˆë‹¤ `try ~ catch ~ finally` ë¥¼ ë°˜ë³µí•´ì•¼ í•œë‹¤.
  * í•µì‹¬ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ë³´ë‹¤ ë‹¤ë¥¸ ë¡œì§ì´ ë” ë§ë‹¤.
    
## íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì € (íŠ¸ëœì­ì…˜ ì¶”ìƒí™”)
![](https://velog.velcdn.com/images/pipiolo/post/61753f46-d2a5-4eec-b6d0-af0f98b020f8/image.png)

* `PlatformTransactionManager` íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ í†µí•´ ì¶”ìƒí™”í–ˆë‹¤.
  * JDBC, JPA, Hibernate ë“± ë‹¤ì–‘í•œ íŠ¸ëœì­ì…˜ êµ¬í˜„ì²´ë¥¼ ê°ˆì•„ë¼ìš°ë©´ ëœë‹¤.
  * ê¸°ìˆ  ë³€ê²½ ì‹œ, ì˜ì¡´ê´€ê³„ ì£¼ì…ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.
* ì„œë¹„ìŠ¤ ê³„ì¸µì€ ìˆœìˆ˜í•˜ë‹¤.
  * ì„œë¹„ìŠ¤ ê³„ì¸µì„ ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ ë¡œë¶€í„° ë³´í˜¸í•  ìˆ˜ ìˆë‹¤.
  * ì¶”ìƒí™”ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê³„ì¸µì€ JDBC, JPA ê°™ì€ íŠ¹ì • ê¸°ìˆ ì— ì˜ì¡´í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
    * `SQLException` ì—ì™¸ ê´€ë ¨ ê¸°ìˆ  ì˜ì¡´ì€ ì•„ì§ í•´ê²°í•˜ì§€ ëª» í–ˆë‹¤.


## íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €
![](https://velog.velcdn.com/images/pipiolo/post/b48ead89-c751-4591-bbca-a7b087fadcb1/image.png)

* íŠ¸ëœì­ì…˜ì„ ìœ ì§€í•˜ë ¤ë©´ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€(`ë™ê¸°í™”`) í•´ì•¼ í•œë‹¤.
* íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ë¥¼ í†µí•´ ê°™ì€ ì»¤ë„¥ì…˜ì„ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.
  * ë‚´ë¶€ì—ì„œ ì“°ë ˆë“œ ë¡œì»¬(`ThreadLocal`)ì„ í†µí•´ ì»¤ë„¥ì…˜ì„ ë™ê¸°í™”í•œë‹¤.
    * ë©€í‹° ì“°ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì „í•˜ê²Œ ë™ì‘í•œë‹¤.
  * ì»¤ë„¥ì…˜ì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.
* íŠ¸ëœì­ì…˜ì€ ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•œë‹¤.
  1. ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤. 
  2. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ ì»¤ë„¥ì…˜ í’€ì„ í†µí•´ ì»¤ë„¥ì…˜ì„ ì–»ëŠ”ë‹¤.
  3. ì»¤ë„¥ì…˜ì„ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë¸Œë„ ë³€ê²½í•´ì„œ íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì— ë³´ê´€í•œë‹¤.
  4. íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ëŠ” ì“°ë ˆë“œ ë¡œì»¬ì— ì»¤ë„¥ì…˜ì„ ë³´ê´€í•œë‹¤.
  5. **ë¦¬í¬ì§€í† ë¦¬ëŠ” íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì„ í†µí•´ ì»¤ë„¥ì…˜ì„ ì–»ëŠ”ë‹¤.**
  6. ì´ë¥¼ í†µí•´ **ê°™ì€ ì»¤ë„¥ì…˜, ê°™ì€ íŠ¸ëœì­ì…˜ì„ ìœ ì§€**í•œë‹¤.
  7. ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ íŠ¸ëœì­ì…˜ì„ ì¢…ë£Œí•œë‹¤.
  8. íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ëŠ” íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì € ì“°ë ˆë“œ ë¡œì»¬ì— ë³´ê´€ëœ ì»¤ë„¥ì…˜ì„ ê°€ì§€ê³  ì˜¨ë‹¤.
  9. íšë“í•œ ì»¤ë„¥ì…˜ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì»¤ë°‹í•˜ê±°ë‚˜ ë¡¤ë°±í•œë‹¤.
  10. ì „ì²´ ë¦¬ì†ŒìŠ¤ë¥¼ ì •ë¦¬í•œë‹¤.
      * íŠ¸ëœì­ì…˜ ë™ê¸°í™” ë§¤ë‹ˆì €ì˜ ì“°ë ˆë“œ ë¡œì»¬ì„ ì •ë¦¬í•œë‹¤.
      * ìë™ ì»¤ë°‹ ëª¨ë“œë¡œ ë˜ëŒë¦°ë‹¤. ì»¤ë„¥ì…˜ í’€ì„ ê³ ë ¤í•´ì•¼ í•œë‹¤.
      * ì»¤ë„¥ì…˜ì„ ì»¤ë„¥ì…˜ í’€ì— ë°˜í™˜í•œë‹¤.

## íŠ¸ëœì­ì…˜ í…œí”Œë¦¿
```java
@Service
public class Service {
	
    private final TransactionTemplate txTemplate;
    
    public void service(String fromId, String toId, Integer money) {
    	txTemplate.executeWithoutResult((status) -> {
			try {
				bizLogic(fromId, toId, money);
    		} catch (SQLException e) {
         		throw new IllegalStateException(e);
    		}
		});
    }
} 



```

* `TransactionTemplate` ì„ í†µí•´ íŠ¸ëœì­ì…˜ ì‹œì‘, ì»¤ë°‹, ë¡¤ë°± í•˜ëŠ” ì½”ë“œë¥¼ ì œê±°í–ˆë‹¤.
  * ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ ê²°ê³¼ì— ë”°ë¼ ìë™ìœ¼ë¡œ ì»¤ë°‹ í˜¹ì€ ë¡¤ë°±í•œë‹¤.
* `try ~ catch` ëŠ” `SQLException` ì²´í¬ ì˜ˆì™¸ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•¨ì´ë‹¤.
  * íŠ¸ë˜ì­ì…˜ ì¶”ìƒí™”ë¡œë„ í•´ê²°í•˜ì§€ ëª» í•œ íŠ¹ì • ê¸°ìˆ ì— ì˜ì¡´í•˜ëŠ” ë¬¸ì œì´ë‹¤.

## í•œê³„
* íŠ¸ëœì­ì…˜ ì¶”ìƒí™”, ë™ê¸°í™”, í…œí”Œë¦¿ì„ í†µí•´ ë§ì€ ë¬¸ì œë“¤ì„ í•´ê²°í–ˆë‹¤.
* í•˜ì§€ë§Œ, ì„œë¹„ìŠ¤ ê³„ì¸µì— ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ë¿ë§Œ ì•„ë‹ˆë¼ íŠ¸ëœì­ì…˜ ê¸°ìˆ  ë¡œì§ì´ í•¨ê»˜ í¬í•¨ë˜ì–´ ìˆë‹¤.
  * ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì€ í•µì‹¬ê¸°ëŠ¥ ì´ê³ , íŠ¸ëœì­ì…˜ ë¡œì§ì€ ë¶€ê°€ê¸°ëŠ¥ì´ë‹¤.
  * ë‘ ê´€ì‹¬ì‚¬ê°€ í•œ ê³³ì— ìˆìœ¼ë©´, ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì–´ë µë‹¤.
* ì„œë¹„ìŠ¤ ê³„ì¸µì€ í•µì‹¬ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ë§Œ ìˆì–´ì•¼ í•œë‹¤.

## íŠ¸ëœì­ì…˜ AOP
```java
public class TransactionProxy {
	
    private final Service target;
    private fianl TransactionManager transactionManager;
    
    public void logic() {
    	TransactionStatus status = transactionManager.getTransaction(..);
        try {
        	target.logic();
            transactionManager.commit(status);
        } catch (Exception e) {
        	transactionManager.rollback(status);
            throw new IllegalStateExcepeion(e);
        }
    }
}
```
```java
@Service
public class Service {

	public void logic() {
    	bizLogic();
    }
}
```
![](https://velog.velcdn.com/images/pipiolo/post/d0d0ec8d-ddfd-45b1-8ecc-a1c01d17e5a6/image.png)

* ê¸°ì¡´ì—ëŠ” ì„œë¹„ìŠ¤ ê³„ì¸µì— íŠ¸ëœì­ì…˜ê³¼ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì´ ì„ì—¬ ìˆì—ˆë‹¤.
* íŠ¸ëœì­ì…˜ í”„ë¡ì‹œê°€ íŠ¸ëœì­ì…˜ ë¡œì§ì„ ë‹´ë‹¹í•˜ê³  ì„œë¹„ìŠ¤ ê³„ì¸µì€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ë§Œ ì±…ì„ì§„ë‹¤.
  * í”„ë¡ì‹œë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê³„ì¸µì€ ì´ì œ ìˆœìˆ˜í•˜ë‹¤.
  
### ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ AOP
```java
@Service
public class Service {
	
    @Transactional
	public void logic() {
    	bizLogic();
    }
}
```
* `@Transactional` ì• ë…¸í…Œì´ì…˜ì„ í†µí•´ í”„ë¡ì‹œë¥¼ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆë‹¤.
* íŠ¸ëœì­ì…˜ í”„ë¡ì‹œ í´ë˜ìŠ¤ê°€ ìë™ìœ¼ë¡œ ìƒì„±ëœë‹¤.

![](https://velog.velcdn.com/images/pipiolo/post/9bf5f90b-101a-4a9f-89b4-6bfeef052298/image.jpeg)

---
